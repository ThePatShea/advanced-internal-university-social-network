<head>
  <! Makes the site size correctly on mobile devices !>
    <meta content="width=device-width,minimum-scale=1,maximum-scale=1" name="viewport">

  <! Activates Typekit fonts !>
    <script type="text/javascript" src="//use.typekit.net/yiq3yhp.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

  <! Sets the favicon !>
    <link rel="icon" type="image/ico" href="/img/favicon.ico">

  <! Sets the text in the browser's title bar !>
    <title>Emory Bubble</title>

  <! Initializes the support widget !>
    <!--<script type="text/javascript" src="https://loader.engage.gsfn.us/loader.js"></script> 
    <script type="text/javascript"> if (typeof GSFN !== "undefined") { GSFN.loadWidget(6125,{"containerId":"getsat-widget-6125"}); } </script>
    <script type="text/javascript" src="/js/jrac/jquery.jrac.js"></script>-->


    <script type="text/javascript">
      var pushNotification;
      
      function onDeviceReady() {
          $("#app-status-ul").append('<li>deviceready event received</li>');
          
          document.addEventListener("backbutton", function(e)
          {
              $("#app-status-ul").append('<li>backbutton event received</li>');
              
              if( $("#home").length > 0)
              {
                  // call this to get a new token each time. don't call it to reuse existing token.
                  //pushNotification.unregister(successHandler, errorHandler);
                  e.preventDefault();
                  navigator.app.exitApp();
              }
              else
              {
                  navigator.app.backHistory();
              }
          }, false);
      
          try 
          { 
              pushNotification = window.plugins.pushNotification;
              if (device.platform == 'android' || device.platform == 'Android') {
                  $("#app-status-ul").append('<li>registering android</li>');
                  pushNotification.register(successHandler, errorHandler, {"senderID":"661780372179","ecb":"onNotificationGCM"});     // required!
              } else {
                  $("#app-status-ul").append('<li>registering iOS</li>');
                  pushNotification.register(tokenHandler, errorHandler, {"badge":"true","sound":"true","alert":"true","ecb":"onNotificationAPN"});    // required!
              }
          }
          catch(err) 
          { 
              txt="There was an error on this page.\n\n"; 
              txt+="Error description: " + err.message + "\n\n"; 
              alert(txt); 
          } 
      }
      
      // handle APNS notifications for iOS
      function onNotificationAPN(e) {
          if (e.alert) {
               $("#app-status-ul").append('<li>push-notification: ' + e.alert + '</li>');
               navigator.notification.alert(e.alert);
          }
              
          if (e.sound) {
              var snd = new Media(e.sound);
              snd.play();
          }
          
          if (e.badge) {
              pushNotification.setApplicationIconBadgeNumber(successHandler, e.badge);
          }
      }
      
      function tokenHandler (result) {
          $("#app-status-ul").append('<li>token: '+ result +'</li>');
          // Your iOS push server needs to know the token before it can push to this device
          // here is where you might want to send it the token for later use.
      }
      
      function successHandler (result) {
          $("#app-status-ul").append('<li>success:'+ result +'</li>');
      }
      
      function errorHandler (error) {
          $("#app-status-ul").append('<li>error:'+ error +'</li>');
      }
      
      document.addEventListener('deviceready', onDeviceReady, true);

   </script>

    <link rel="stylesheet" type="text/css" href="/js/jrac/style.jrac.css" />
    <script type="text/javascript" src="/js/arbor.js"></script>
</head>
<body>
  {{> googleAnalytics}}
  <div class="viewport">
    <div class="frame">

      {{#if isLoggedIn}}
      <button class="sidebar-collapse" data-toggle="collapse" data-target="#menu">
        <span class="sidebar-arrow-right">{{> icon-sidebar-arrow-right}}</span>
        <span class="sidebar-arrow-left">{{> icon-sidebar-arrow-left}}</span>
      </button>
        <div id="menu" class="menu nav-collapse collapse width">
          {{> sidebar}}
        </div>
      {{/if}}

      <div class="view">
        {{#if isLoggedIn}}
          {{> header}}
        {{/if}}
        <div id="main" class="row-fluid">
          {{> errors}}
          {{renderPage}}
        </div>
      </div>
    </div>
  </div>
</body>
